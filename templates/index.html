<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ä¼šè®®è½¬å½•ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../static/style.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <nav class="navbar">
        <h1>ä¼šè®®è½¬å½•ç³»ç»Ÿ</h1>
    </nav>
    <!-- ä¸Šä¼ åŒºåŸŸ -->
    <div class="container">
        <div>
            <form id="upload-form" enctype="multipart/form-data">
                <div class="upload-box">
                    <input type="file" name="audio_file" id="file-input">
                    <label for="file-input" class="upload-label">
                        ğŸ“ ç‚¹å‡»é€‰æ‹©ä¼šè®®å½•éŸ³æ–‡ä»¶ï¼ˆæ”¯æŒ.wav .mp3æ ¼å¼ï¼‰
                    </label>
                    <!-- <p style="margin-top: 1rem; color: #666;">æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤åŒºåŸŸ</p> -->
                </div>
                <div class="upload-footer">
                    <input type="submit" class="convert-btn" 
                    value=å¼€å§‹è½¬æ¢>
                </div>
            </form>
            <!-- <form id="upload-form" enctype="multipart/form-data">
                <input type="file" name="audio_file">
                <input type="submit" value="è½¬æ¢">
            </form> -->
        </div>
        <div class="result-box" id="result-container">
            <!-- <h2>è½¬æ¢ç»“æœ</h2> -->
            <div class="result-header">
                <!-- <a id="download-link" style="display: none;" href="#">ä¸‹è½½æ–‡æœ¬</a> -->
                <a id = "download-link" class="download-btn" style="display: none;">
                        <span class="download-icon">â¬‡ï¸</span>ä¸‹è½½æ–‡æœ¬
                </a>
            </div>
            <textarea id="result-textarea" 
                     placeholder="è½¬æ¢ç»“æœå°†åœ¨æ­¤æ˜¾ç¤º..." 
                     readonly></textarea>
        </div>
    </div>

    <script>
        const form = document.getElementById('upload-form');
        const resultTextarea = document.getElementById('result-textarea');
        const downloadLink = document.getElementById('download-link');
        // æ–‡ä»¶é€‰æ‹©åé¦ˆ
        document.getElementById('file-input').addEventListener('change', (e) => {
            const files = e.target.files;
            if(files.length > 0) {
                document.querySelector('.upload-label').textContent = files[0].name;
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);

            try {
                const response = await fetch('/convert', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                resultTextarea.value = data.message;

                // è½®è¯¢æ£€æŸ¥å¤„ç†ç»“æœ
                const checkResult = async () => {
                    const resultResponse = await fetch(`/check_result/${data.task_id}`);
                    const resultData = await resultResponse.json();
                    if (resultData.status === 'å®Œæˆ') {
                        resultTextarea.value = resultData.result;
                        downloadLink.href = `/download/${data.task_id}`;
                        downloadLink.style.display = 'block';
                    } else {
                        setTimeout(checkResult, 2000); // æ¯ 2 ç§’æ£€æŸ¥ä¸€æ¬¡
                    }
                };
                checkResult();
            } catch (error) {
                resultTextarea.value = 'å¤„ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯';
            }
        });
    </script>
</body>

</html>
